{% extends "calendar/calendar/base.html" %}
{% load i18n %}
{% load calendartools_tags %}
{% block title %}
  {{ day|date:"SHORT_DATE_FORMAT" }} - Daily View - {{ block.super }}
{% endblock %}

{% block heading %}
<h3>{% trans "Daily View" %} - <span class="calendarname">{{ calendar.name }}</span> {% trans "Calendar" %}</h3>
{% endblock %}

{% block agenda_url %}{% url day-agenda calendar.slug day.year day.get_month.abbr day.number %}{% endblock %}
{% block current_nav_url %}{% url day-calendar calendar.slug today.year today.get_month.abbr today.number %}{% endblock %}

{% block calendar_nav %}
<div id="calendar-nav" class="nav">
  <table>
    <tr>
      <td class="first">
        {% url day-calendar calendar.slug day.previous.year day.previous.get_month.abbr day.previous.number as previous_url %}
        <a rel="{% if day.previous < earliest_occurrence %}nofollow{% else %}prev{% endif %}"
          href="{{ previous_url|persist_query_string }}"
          title="{% trans "Previous day" %}"><span>{% trans "Previous day" %}</span>&larr;
        </a>
      </td>
      <td>
        {% url day-calendar calendar.slug day.year day.get_month.abbr day.start.day as day_url %}
        <a class="active" title="{% trans "View" %} {{ day|date:"DATE_FORMAT"}}"
          href="{{ day_url|persist_query_string }}">
          {% trans "Day" %}
        </a>
      </td>
      <td>
        {% if day == today %}
        {% url week-calendar calendar.slug today.year today.get_week.number as week_url %}
        <a title="{% trans "View" %} {{ today.get_week.start }}"
          href="{{ week_url|persist_query_string }}">
          {% trans "Week" %}
        </a>
        {% else %}
        {% url week-calendar calendar.slug day.year day.get_week.number as week_url %}
        <a title="{% trans "View" %} {{ day.get_week.start }}"
          href="{{ week_url|persist_query_string }}">
          {% trans "Week" %}
        </a>
        {% endif %}
      </td>
      <td>
        {% url month-calendar calendar.slug day.year day.get_month.abbr as month_url %}
        <a title="{% trans "View" %} {{ day.get_month.name }}"
          href="{{ month_url|persist_query_string }}">
          {% trans "Month" %}
        </a>
      </td>
      <td>
        {% url year-calendar calendar.slug day.year as year_url %}
        <a title="{% trans "View" %} {{ day.year }}"
          href="{{ year_url|persist_query_string }}">
          {% trans "Year" %}
        </a>
      </td>
      <td class="last">
        {% url day-calendar calendar.slug day.next.year day.next.get_month.abbr day.next.number as next_url %}
        <a rel="{% if day.next > latest_occurrence %}nofollow{% else %}next{% endif %}"
          href="{{ next_url|persist_query_string }}"
          title="{% trans "Next day" %}">&rarr;<span>{% trans "Next day" %}</span>
        </a>
      </td>
    </tr>
  </table>
</div>
{% endblock %}

{% block calendar %}
<div class="tablewrapper">
  <table class="day calendar">
    <caption>
      <span class="day start">{{ day.start|date:"DATE_FORMAT" }}</span>
      -
      <span class="day finish">{{ day.finish|date:"DATE_FORMAT" }}</span>
    </caption>

    <tbody>
      <tr>
        {% with day.intervals as intervals %}
        {% for column in intervals|columns:2 %}
        <td>
          <table class="day column column-{{ forloop.counter }}{% cycle "" " alt" %}">

            <colgroup>
              <col class="day time {{ day|time_relative_to_today }}" />
              <col class="day events {{ day|time_relative_to_today }}" />
            </colgroup>

            <thead>
              <tr>
                <th>{% trans "Time" %}</th>
                <th>{% trans "Events" %}</th>
              </tr>
            </thead>

            <tbody>
            {% for cell in column %}
            <tr class="day row {% if forloop.counter|divisibleby:2 %}alt{% endif %}{% if now in cell %} now{% endif %}">
              {# can't use cycle tag until http://code.djangoproject.com/ticket/5908 lands #}
                <td class="day time {{ cell|time_relative_to_today }}{% if now in cell %} now{% endif %}">
                  {{ cell.start|time:"TIME_FORMAT" }}
                </td>
                <td class="day events">
                  {% if cell.occurrences %}
                  <ul class="occurrences">
                    {% for o in cell.occurrences %}
                    <li class="period vevent {{ o.status_slug }}">
                      <a class="summary url" href="{{ o.get_absolute_url }}">
                        <span class="name">{{ o.event.name }}</span>
                      </a>
                      <span class="start time">
                        <abbr class="dtstart" title="{{ o.start|date:"c" }}">
                          {{ o.start|date:"TIME_FORMAT" }}
                        </abbr>
                      </span>
                      <em> - </em>
                      <span class="finish time">
                        <abbr class="dtend" title="{{ o.finish|date:"c" }}">
                          {{ o.finish|date:"TIME_FORMAT" }}
                        </abbr>
                      </span>
                    </li><!-- end .vevent -->
                    {% endfor %}
                  </ul>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table><!-- end day-column-{{ forloop.counter }}-->
        </td>
        {% endfor %}
        {% endwith %}
      </tr>
    </tbody>
  </table><!--end .day.calendar -->
</div>
{% endblock %}

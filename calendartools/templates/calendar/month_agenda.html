{% extends "base.html" %}
{% load i18n %}
{% load calendartools_tags %}
{% block title %}Monthly Agenda - {{ calendar.name }} Calendar - {{ block.super }}{% endblock %}
{% block extra_head %}
  <style type="text/css" media="screen">
    ul#calendar-nav li, ul.filters li {display: inline; list-style: none;}
    .vevent abbr {border:0} /* No borders on microformat markup */
  </style>
{% endblock %}

{% block primary %}
<h3>{% trans "Monthly Agenda" %} - <span class="calendarname">{{ calendar.name }}</span> {% trans "Calendar" %}</h3>

<p class="toggle-calendar">{% trans "Switch to" %}
  <a href="{% url month-calendar calendar.slug month.year month.abbr %}">
    {% trans "calendar view" %}
  </a>.
</p>

<ul id="calendar-nav" class="nav">
  <li>
    <a rel="{% if month.previous < earliest_occurrence %}nofollow{% else %}prev{% endif %}"
       href="{% url month-agenda calendar.slug month.previous.year month.previous.abbr %}"
       title="{% trans "Last Month" %}">&larr;
    </a>
  </li>
  <li>
    <a title="{% trans "View" %} {{ month.name }}"
       href="{% url month-agenda calendar.slug month.year month.abbr %}">
       {{ month|date:"F" }}
     </a>
  </li>
  <li>
    <a title="{% trans "View" %} {{ month.year }}"
       href="{% url year-agenda calendar.slug month.year %}">
       {{ month|date:"Y" }}
    </a>
  </li>
  <li>
    <a rel="{% if month.next > latest_occurrence %}nofollow{% else %}next{% endif %}"
       href="{% url month-agenda calendar.slug month.next.year month.next.abbr %}"
       title="{% trans "Next Month" %}">&rarr;
    </a>
  </li>
</ul>

{% with request.get_full_path as here %}
{% with here|get_query_string:"period" as period %}
<ul class="filters">
  <li><a class="{% if "past" in period %}on{% endif %}"
         href="{{ here|set_query_string:"period,past" }}">past</a></li>
  <li><a class="{% if "future" in here|get_query_string:"period" %}on{% endif %}"
         href="{{ here|set_query_string:"period,future" }}">future</a></li>
  <li><a class="{% if "today" in here|get_query_string:"period" %}on{% endif %}"
         href="{{ here|set_query_string:"period,today" }}">today</a></li>
  <li><a class="{% if "all" in period %}on{% endif %}"
         href="{{ here|delete_query_string:"period" }}">all</a></li>
</ul>
{% endwith %}
{% endwith %}

{% if not month.occurrences %}
  <p>No events occurring in {{ month }}</p>
{% else %}

<ul class="follow utils">
  <li>
  <a class="feed" href="http://feeds.technorati.com/events/{{ current_site.domain }}{{ request.get_full_path }}">
      Add Events to Calendar
    </a>
  </li>
  <li>
  <a class="subscribe" href="webcal://feeds.technorati.com/events/{{ current_site.domain }}{{ request.get_full_path }}">
      Subscribe to Events
    </a>
  </li>
</ul>

<table class="month-agenda">
  <caption>
    <span class="month start">{{ month.start|date:"DATE_FORMAT" }}</span>
    -
    <span class="month finish">{{ month.finish|date:"DATE_FORMAT" }}</span>
  </caption>

  <colgroup>
    <col class="day" />
    <col class="title alt" />
    <col class="start" />
    <col class="end alt" />
  </colgroup>

  <thead>
    <tr>
      <th>{% trans "Day" %}</th>
      <th>{% trans "Title" %}</th>
      <th>{% trans "Start" %}</th>
      <th>{% trans "End" %}</th>
    </tr>
  </thead>

  <tbody>
    {% for day in month.days %}
      {% if day.occurrences %}
        <tr class="day-divider {{ day.abbr|notrans }} vevent">
          <th class="start date" rowspan="{{ day.occurrences|length }}">
            <a href="{% url day-agenda calendar.slug day.year day.get_month.abbr day.number %}">
              {{ day|date:"DATE_FORMAT" }}
            </a>
          </th>
        {% for o in day.occurrences %}
          <td class="summary">
            <a class="{{ o.status_slug }} summary url"
               href="{{ o.get_absolute_url }}">
               <span class="name">{{ o.name }}</span>
            </a>
          </td>
          <td class="start time">
            <abbr class="dtstart" title="{{ o.start|date:"c" }}">
              {{ o.start|date:"TIME_FORMAT" }}
            </abbr>
          </td>
          <td class="finish time">
            <abbr class="dtend" title="{{ o.finish|date:"c" }}">
              {{ o.finish|date:"TIME_FORMAT" }}
            </abbr>
          </td>
        </tr>
          {% if not forloop.last %}
        <tr class="{{ day.abbr|notrans }} vevent">
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endfor %}
  </tbody>
</table>
{% endif %}
{% endblock %}
